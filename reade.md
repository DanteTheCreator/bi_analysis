# Python Project: Conversational Data Retrieval and Manipulation

This project is designed to facilitate non-technical users in interacting with databases and manipulating data through conversational agents. The system comprises several agents that handle user inputs, decompose tasks, generate SQL queries, and produce Python scripts for data manipulation and visualization.

## Table of Contents

- [Installation](#installation)
- [Usage](#usage)
- [Project Structure](#project-structure)
- [Agent Descriptions](#agent-descriptions)
- [Database Operations](#database-operations)
- [Streamlit Interface](#streamlit-interface)
- [Sandbox Environment](#sandbox-environment)

## Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/yourusername/yourproject.git
   cd yourproject
   ```

1.  Install the required packages:

    `pip install -r requirements.txt`

2.  Set up the database:

    -   Create the necessary tables in Clickhouse and PostgreSQL.
    -   Update the database connection strings in the code where required.

## Usage

To run the application, execute the following command:

`streamlit run app.py`

## Project Structure

-   `autogen/`: Contains classes for the agents used in the project.
-   `database_connection.py`: Handles database connections and queries.
-   `utils.py`: Contains utility functions for data extraction and script writing.
-   `sandbox.py`: Implements a minimal sandbox environment for executing Python code.
-   `front_components.py`: Streamlit components for the user interface.
-   `app.py`: Main application file for running the Streamlit app.
-   `requirements.txt`: List of required Python packages.

Agent Descriptions
------------------

### UserProxyAgent

-   **Purpose**: Acts as an intermediary between the user and other agents.
-   **Configuration**: Defined in the `Agency` class.

### ConversableAgent

-   **Purpose**: Handles conversational interactions with the user, decomposes tasks, and generates SQL queries and Python scripts.
-   **Types**: Includes `talker`, `python_talker`, `decomposer_for_queries`, `query_builder`, and `decomposer_for_scripts`.

### SimpleAuth

-   **Purpose**: Manages user authentication and permissions.
-   **Configuration**: Uses SQLAlchemy for database interactions and Passlib for password hashing.

Database Operations
-------------------

The project supports various database operations, including:

-   Running SQL queries
-   Adding temporary tables
-   Inserting data into Clickhouse
-   Loading data from Clickhouse

Streamlit Interface
-------------------

The user interface is built using Streamlit and provides the following functionalities:

-   **Login Form**: For user authentication.
-   **Chat Interface**: For interacting with the agents.
-   **Upload Form**: For uploading CSV and Excel files.
-   **Buttons**: For resetting the session, fetching data, and saving chat history.
-   **Sidebar**: For displaying saved shortcuts and chat titles.

Sandbox Environment
-------------------

A minimal sandbox environment is implemented to securely execute Python scripts generated by the agents. The sandbox allows specific modules like `pandas`, `matplotlib.pyplot`, and `seaborn`.